#include "StdAfx.h"
#include "Diablo Edit2.h"
#include "PlayerStats.h"
#include <vector>





/*
	cf.Read(bData,MAX_SIZE);	//bData[0]和bData[1]是"gf"
	UINT bytePos = 2,bitPos = 0;
	DWORD index = ReadBits(9,bytePos,bitPos);
	for(UINT i = 0;index < ARRAY_SIZE && i <= index;++i){
		m_dwValue[index] = ReadBits(BITS_COUNT[index],bytePos,bitPos);
		index = ReadBits(9,bytePos,bitPos);
	}
	if(bitPos)
		++bytePos;
	cf.Seek(LONGLONG(bytePos) - MAX_SIZE,CFile::current);
	return TRUE;
}

void CPlayerStats::MakeData()
{
	::ZeroMemory(bData,sizeof(bData));
	bData[0] = 'g';
	bData[1] = 'f';
	UINT bytePos = 2,bitPos = 0;
	for(int i = 0;i < ARRAY_SIZE;++i){
		if(m_dwValue[i]){
			WriteBits(i,9,bytePos,bitPos);
			WriteBits(m_dwValue[i],BITS_COUNT[i],bytePos,bitPos);
		}
	}
	WriteBits(0x1FF,9,bytePos,bitPos);		//结束标志
	if(bitPos)
		++bytePos;
	nLen = bytePos;
}

DWORD CPlayerStats::ReadBits(UINT bitCount,UINT & bytePos,UINT & bitPos){
	ASSERT(bitCount > 0 && bitCount <= 32 && bitPos < 8 && _T("DWORD CPlayerStats::ReadBits(UINT bitCount,UINT & bytePos,UINT & bitPos)"));
	const DWORD HIGHEST_BIT = 0x80000000;
	DWORD ret = 0;
	for(UINT i = bitCount;i > 0;--i){
		ret >>= 1;
		if((bData[bytePos] >> bitPos) & 1)
			ret += HIGHEST_BIT;
		if(++bitPos == 8)
			bitPos = 0,++bytePos;
	}
	return ret >> (32 - bitCount);
}

void CPlayerStats::WriteBits(DWORD value,UINT bitCount,UINT & bytePos,UINT & bitPos)
{
	ASSERT(bitCount > 0 && bitCount <= 32 && bitPos < 8 && _T("DWORD CPlayerStats::WriteBits(DWORD value,UINT bitCount,UINT & bytePos,UINT & bitPos)"));
	for(;bitCount > 0;--bitCount,value >>= 1){
		if(value & 1)
			bData[bytePos] += 1 << bitPos;
		if(++bitPos == 8)
			bitPos = 0,++bytePos;
	}
}
//*/